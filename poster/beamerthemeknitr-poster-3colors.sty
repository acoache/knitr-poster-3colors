%==============================================================================
% Beamer style for the poster template posted at
% www.nathanieljohnston.com/index.php/2009/08/latex-poster-template
% 
% Created by the Computational Physics and Biophysics Group at Jacobs University
% https://teamwork.jacobs-university.de:8443/confluence/display/CoPandBiG/LaTeX+Poster
% Modified by Anthony Coache (anthony.coache@gmail.com) in April 2021
% =============================================================================

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                         Packages section
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Name of the package
\ProvidesPackage{beamerthemeknitr-poster-3colors}
\RequirePackage{tikz}
\usetikzlibrary{arrows,backgrounds,shadings,fadings}
\RequirePackage[T1]{fontenc}
\RequirePackage{lmodern} % High quality font
\RequirePackage{textcomp}
\RequirePackage{amsmath,amssymb}
\usefonttheme{professionalfonts}
\newcommand{\makeruleinbox}{{\usebeamercolor[bg]{block alerted title}\centering\hspace*{-0.7cm}\rule{\inboxrule}{0.5cm}}}
\usepackage{ragged2e}

% Conditions for the light/dark theme
\newif\if@doDarkTheme
\@doDarkThemefalse
\DeclareOption{DarkTheme}{\@doDarkThemetrue}
\ProcessOptions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                     Colors customization section
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\if@doDarkTheme
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            DARK THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\definecolor{mgreen}{rgb}{0.0,0.6,0.35}
\definecolor{mblue}{rgb}{0.1,0.4,0.5}
\definecolor{mred}{rgb}{0.9,0.3,0}
\definecolor{morange}{rgb}{0.8500,0.3250,0.0980}
\definecolor{myellow}{rgb}{0.9290,0.6940,0.1250}
\definecolor{mgrey}{rgb}{0.95,0.95,0.95}
\definecolor{mblack}{rgb}{0,0,0}
\definecolor{FrameTitleLeft}{rgb}{0.12549,0.42745,0.49412}
\definecolor{FrameTitleRight}{rgb}{0.26275,0.68627,0.78039}

% Set different colors
\colorlet{TitleTextColor}{white}
\colorlet{BgColor}{mblue!15}
\colorlet{MainColor}{mblue}
\colorlet{LinkColor}{mgreen}
\colorlet{AlertColor}{mred}
\colorlet{CaptionColor}{mgreen}
\colorlet{NormalTextColor}{black!90}

\colorlet{BlockBgColor}{BgColor}
\colorlet{BlockTitleBgColor}{BgColor}
\colorlet{BlockTitleTextColor}{MainColor}

\colorlet{AlertedBlockBgColor}{mgrey}
\colorlet{AlertedBlockTitleBgColor}{MainColor}
\colorlet{AlertedBlockTitleTextColor}{white}

%%%%%-- End of DARK THEME --%%%%%
\else
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                            LIGHT THEME
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define colors
\definecolor{mgreen}{rgb}{0.0,0.6,0.35}
\definecolor{mblue}{rgb}{0.1,0.4,0.5}
\definecolor{mred}{rgb}{0.9,0.3,0}
\definecolor{morange}{rgb}{0.8500,0.3250,0.0980}
\definecolor{myellow}{rgb}{0.9290,0.6940,0.1250}
\definecolor{mgrey}{rgb}{0.95,0.95,0.95}
\definecolor{mblack}{rgb}{0,0,0}
\definecolor{FrameTitleLeft}{rgb}{1,1,1}
\definecolor{FrameTitleRight}{rgb}{1,1,1}

% Set different colors
\colorlet{TitleTextColor}{mblue}
\colorlet{BgColor}{white}
\colorlet{MainColor}{mblue}
\colorlet{LinkColor}{mblue}
\colorlet{AlertColor}{mred}
\colorlet{CaptionColor}{mblue}
\colorlet{NormalTextColor}{black!90}

\colorlet{BlockBgColor}{BgColor}
\colorlet{BlockTitleBgColor}{BgColor}
\colorlet{BlockTitleTextColor}{MainColor}

\colorlet{AlertedBlockBgColor}{mgrey}
\colorlet{AlertedBlockTitleBgColor}{MainColor}
\colorlet{AlertedBlockTitleTextColor}{white}

%%%%%-- End of LIGHT THEME --%%%%%
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%                        Configure visual aspects
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Length variables (used by the template)
\newlength{\inboxwd}
\newlength{\iinboxwd}
\newlength{\inboxrule}

% Basic colors
\setbeamercolor{cboxb}{fg=NormalTextColor,bg=MainColor}

% Colors for itemize/enumerate items
\setbeamercolor{item}{fg=MainColor}
\setbeamercolor{item projected}{fg=white,bg=MainColor}

% Colors for blocks
\setbeamercolor{block title}{fg=BlockTitleTextColor,bg=BlockTitleBgColor}
\setbeamercolor{block body}{fg=NormalTextColor,bg=BlockBgColor}
\setbeamercolor{background canvas}{bg=BgColor}

% Colors for alerted blocks and text
\setbeamercolor{block alerted title}{fg=AlertedBlockTitleTextColor,bg=AlertedBlockTitleBgColor}
\setbeamercolor{block alerted body}{fg=NormalTextColor,bg=AlertedBlockBgColor}
\setbeamercolor{alerted text}{fg=AlertColor}

% Style and colors for captions
\setbeamertemplate{caption}[numbered]
\setbeamercolor{caption name}{fg=CaptionColor}

% Fonts
\setbeamerfont{section in head/foot}{series=\bfseries}
\setbeamerfont{block title}{series=\bfseries}
\setbeamerfont{block alerted title}{series=\bfseries}
\setbeamerfont{frametitle}{series=\bfseries}
\setbeamerfont{frametitle}{size=\Large}

% Beamer theme options
\setbeamertemplate{title page}[default][colsep=-4bp,rounded=true]
\setbeamertemplate{sections/subsections in toc}[square] 
\setbeamertemplate{items}[circle]
\setbeamertemplate{blocks}[width=0.0]
\hypersetup{colorlinks=true,linkcolor=LinkColor,urlcolor=LinkColor,citecolor=LinkColor}
\beamertemplatenavigationsymbolsempty

% Bibliography style and colors
\setbeamertemplate{bibliography item}[text]
\setbeamercolor{bibliography item}{fg=black,bg=white}
\setbeamercolor{bibliography entry author}{fg=black,bg=white}
\setbeamercolor{bibliography item}{fg=black,bg=white}

% Itemize environment
\makeatletter
\renewcommand{\itemize}[1][]{%
	\beamer@ifempty{#1}{}{\def\beamer@defaultospec{#1}}%
	\ifnum \@itemdepth >2\relax\@toodeep\else
	\advance\@itemdepth\@ne
	\beamer@computepref\@itemdepth% sets \beameritemnestingprefix
	\usebeamerfont{itemize/enumerate \beameritemnestingprefix body}%
	\usebeamercolor[fg]{itemize/enumerate \beameritemnestingprefix body}%
	\usebeamertemplate{itemize/enumerate \beameritemnestingprefix body begin}%
	\list
	{\usebeamertemplate{itemize \beameritemnestingprefix item}}
	{\def\makelabel##1{%
			{%
				\hss\llap{{%
						\usebeamerfont*{itemize \beameritemnestingprefix item}%
						\usebeamercolor[fg]{itemize \beameritemnestingprefix item}##1}}%
			}%
		}%
	}
	\fi%
	\beamer@cramped%
	\justifying% NEW
	%\raggedright% ORIGINAL
	\beamer@firstlineitemizeunskip%
}
\makeatother

% Poster title and headline
\makeatletter
\pgfdeclarehorizontalshading[FrameTitleLeft,FrameTitleRight]
{beamer@frametitleshade}
{\paperheight}{%
	color(0pt)=(FrameTitleLeft);
	color(\paperwidth)=(FrameTitleRight)
}

\setbeamertemplate{headline}{%
	\hbox{\leavevmode
		\beamer@tempdim=\textwidth%
		\advance\beamer@tempdim by \beamer@leftmargin%
		\advance\beamer@tempdim by \beamer@rightmargin%
		\hbox{%
			\setbox\beamer@tempbox=\hbox{\begin{minipage}[b]{\paperwidth}%
					% Height between the title and the top of the poster
					\vskip0.5cm
					\begin{columns}
						\begin{column}{\linewidth}
							\vskip0.5cm
							\centering
							\usebeamercolor{title in headline}{\color{TitleTextColor} \textbf{\LARGE{\inserttitle}}\\[1ex]} 
							\vskip0.2cm
							\usebeamercolor{author in headline}{\color{TitleTextColor} \Large{\insertauthor}\\[1ex]}
							\usebeamercolor{institute in headline}{\color{TitleTextColor}\large{\insertinstitute}\\[1ex]}
							\vskip0.8cm
						\end{column}
						\vspace{0.8cm}
					\end{columns}
					\vspace{0.3in}
					\begin{beamercolorbox}[wd=48in,colsep=0.15cm]{cboxb}\end{beamercolorbox}
			\end{minipage}}%
			\beamer@tempdim=\ht\beamer@tempbox%
			\advance\beamer@tempdim by 4pt%
			\begin{pgfpicture}{0pt}{0pt}{\paperwidth}{\beamer@tempdim}
				\usebeamercolor{frametitle right}
				\pgfpathrectangle{\pgfpointorigin}{\pgfpoint{\paperwidth}{\beamer@tempdim}}
				\pgfusepath{clip}
				\pgftext[left,base]{\pgfuseshading{beamer@frametitleshade}}
			\end{pgfpicture}
			\hskip-\paperwidth%
			\box\beamer@tempbox%
		}%
		\hskip-\Gm@rmargin%
	}%
	\nointerlineskip
}
\makeatother

% Block environment

\setbeamertemplate{block begin}
{
  \par\vskip\medskipamount
  \begin{beamercolorbox}[colsep*=0ex,dp={2ex},center]{block title}
    \vskip-0.25cm
    \usebeamerfont{block title}\large\insertblocktitle
    \begin{flushleft}
    \vskip-1cm
    \begin{tikzpicture}[remember picture,overlay]
      \shade [inner color=gray,outer color=BgColor]
      (0,0) rectangle (\textwidth,0.3cm);
    \end{tikzpicture}
    \end{flushleft}
  \end{beamercolorbox}
  {\parskip0pt\par}
  \ifbeamercolorempty[bg]{block title}
  {}
  {\ifbeamercolorempty[bg]{block body}{}{\nointerlineskip\vskip-0.5pt}}
  \usebeamerfont{block body}
  \vskip-0.5cm
  \begin{beamercolorbox}[colsep*=0ex,vmode]{block body}
  \justifying 
}

\setbeamertemplate{block end}  
{
  \end{beamercolorbox}
  \vskip\smallskipamount
}

% Alerted block environment

\setbeamertemplate{block alerted begin}
{
  \par\vskip\medskipamount
  \begin{beamercolorbox}[sep=0ex,rounded=true,center,dp={2ex}]{block alerted title}
    \vskip0.01cm
    \usebeamerfont{block title}\large\insertblocktitle
  \end{beamercolorbox}
  {\parskip0pt\par}
  \usebeamerfont{block body}
  \vskip-0.8cm
  \begin{beamercolorbox}[sep=0.5cm, rounded=true,center]{block alerted title}
  \setlength{\inboxwd}{\linewidth}
  \addtolength{\inboxwd}{-1cm}
  \begin{beamercolorbox}[rounded=true,wd={\inboxwd},center]{block alerted body}
  \setlength{\iinboxwd}{\inboxwd}
  \setlength{\inboxrule}{\inboxwd}
  \addtolength{\iinboxwd}{-0.5cm}
  \addtolength{\inboxrule}{0.5cm}
  \begin{center}
  \begin{minipage}{\iinboxwd}
  \justifying 
}

\setbeamertemplate{block alerted end}  
{
  \end{minipage}
  \end{center}
  \end{beamercolorbox}
  \end{beamercolorbox}
  \vskip\smallskipamount
}
